function Collapsable(e){e=e||{},this.containerid=e.containerid||"contenedor",this.container=e.container||document.getElementById(this.containerid),this.titulo=e.titulo||"Titulo",this.headerId=e.headerId||"collapse_header",this.inicializa()}function LeyendaView(e){Collapsable.call(this,e),e=e||{},this.lista=e.lista||[{icon:"img-url",name:"Nombre"}],this.fillBody()}function ListaSismosView(e){Collapsable.call(this,e),e=e||{},this.lista=[{id:"ID",nombre:"Nombre",intensidad:"Ligero",ssn:"ssn",localidad:"Localidad",alertapub:!0,alertapre:!0,fecha:"19 feb 2018 10:00:00"}],this.columns=[{head:"Nombre",width:105,cl:"left",html:function(e){return e.nombre}},{head:"Intensidad",width:70,cl:"center",html:function(e){return e.intensidad}},{head:"Alerta",width:50,cl:"center",html:function(e){return e.alertapub||e.alertapre?"&#10004;":""}},{head:"Ssn",width:50,cl:"center",html:function(e){return e.ssn}},{head:"Fecha",width:130,cl:"center",html:function(e){return e.fecha}},{head:"Localidad",width:205,cl:"left",html:function(e){return e.localidad}}],this.tablaData=this.initTable(),this.pbody.appendChild(this.initPaginator()),this.pbody.appendChild(this.tablaData.tabla)}function InfoEvento(e){e=e||{},this.posicion=e.posicion,this.container=e.container,this.maxNumSensores=e.maxNumSensores||7,this.map=e.map,this.diff=e.diff||0,this.container.className="w-10 sm",this.eventoId=0,this.corriendo=!1,this.visible=!1,this.showTime,this.bufferEventos=[],this.posCliente=e.posCliente||new google.maps.LatLng(18.3,-99.2),this.container.style.display="none",this.init(),this.markerS=new google.maps.Circle({center:this.posicion,radius:1e4,strokeColor:"#ff0000",strokeOpacity:.8,strokeWeight:3,fillColor:"#FF0000",fillOpacity:.05,map:this.map}),this.markerS.setVisible(!1),this.markerP=new google.maps.Circle({center:this.posicion,radius:1e4,strokeColor:"#ffa0ff",strokeOpacity:.9,strokeWeight:2,fillColor:"#E0E0E0",fillOpacity:0,map:this.map}),this.markerP.setVisible(!1),this.markerSsn=new google.maps.Marker({position:this.posicion,icon:{path:"M 0 7 L 7.053 9.708 L 6.657 2.163 L 11.413 -3.708 L 4.114 -5.663 L 0 -12 L -4.114 -5.663 L -11.413 -3.708 L -6.657 2.163 L -7.053 9.708 L 0 7 z",scale:2,fillColor:"red",fillOpacity:.6,strokeColor:"yellow",strokeWeight:1,strokeOpacity:.75},label:{fontWeight:"bold",fontSize:"10",color:"#00f0f0",text:"0"},title:"Información del Sismo",visible:!1,zIndex:1e5,map:this.map}),this.CirculosEpicentro=[],this.CirculosEpicentro.push(CircleInKm(this.posicion,2e5,!0)),this.CirculosEpicentro.push(CircleInKm(this.posicion,15e4,!0)),this.CirculosEpicentro.push(CircleInKm(this.posicion,1e5,!0)),this.CirculosEpicentro.push(CircleInKm(this.posicion,5e4,!1)),this.SensoresMarks=[],this.columnsSensores=[{head:"Número",cl:"center",html:function(e){return e.numero}},{head:"Nombre",cl:"left",html:function(e){return e.nombre}},{head:"Hora",cl:"center",html:function(e){return e.hora}},{head:"Intensidad",cl:"center",html:function(e){return 1==e.color?"Ligero":2==e.color?"Moderado":"Fuerte"}},{head:"Amax",cl:"right",html:function(e){return null==e.amaxMh?"":e.amaxMh}}],this.columnsCentrales=[{head:"Número",cl:"center",html:function(e){return e.numero}},{head:"Nombre",cl:"center",html:function(e){return e.nombre}},{head:"Hora",cl:"center",html:function(e){return e.hora}},{head:"Alerta",cl:"center",html:function(e){return e.alerta}},{head:"Distancia",cl:"center",html:function(e){return e.distancia}},{head:"Anticipación",cl:"center",html:function(e){return e.anticipacion}}],this.semaforo=1}function CircleInKm(e,t,i,a){return t=t||12e4,a=a||"#FF4040",i=i||!1,new google.maps.Circle({center:e,radius:t,strokeColor:a,strokeOpacity:.8,strokeWeight:1,fillColor:"#FF0000",fillOpacity:i?0:.1})}Collapsable.prototype.inicializa=function(){var e=document.createElement("div");e.className="card special-card small";var t=document.createElement("div");t.className="card-header",t.id=this.headerId;var i=document.createElement("div");i.className="collapse show",i.id=this.containerid+"_BodyId";var a=this.createHeaderButton(this.titulo,i.id);t.appendChild(a),e.appendChild(t),this.pbody=document.createElement("div"),this.pbody.className="card-body",this.pbody.style.padding="2px 5px",i.appendChild(this.pbody),e.appendChild(i),this.container.appendChild(e)},Collapsable.prototype.hide=function(){this.container.style.display="none"},Collapsable.prototype.toggleView=function(){"none"===this.container.style.display?this.container.style.display="block":this.container.style.display="none"},Collapsable.prototype.createHeaderButton=function(e,t){var i=document.createElement("button");return i.innerHTML=e+' <span aria-hidden="true" class="dropleft"></span>',i.className="btn btn-outline-secondary btn-sm btn-block dropdown-toggle",i.setAttribute("type","button"),i.setAttribute("data-toggle","collapse"),i.setAttribute("data-target","#"+t),i.setAttribute("aria-expanded","false"),i.setAttribute("aria-controls",t),i},LeyendaView.prototype=Object.create(Collapsable.prototype),LeyendaView.prototype.constructor=LeyendaView,LeyendaView.prototype.fillBody=function(){var e=document.createElement("div");e.className="list-group",this.lista.forEach(function(t,i){var a=document.createElement("div");a.className="list-group-item  special-card";var n=document.createElement("img");n.src=t.icon,n.className="leyenda-icon",a.appendChild(n);var o=document.createElement("small");o.innerHTML=t.name,a.appendChild(o),e.appendChild(a)}),this.pbody.appendChild(e)},ListaSismosView.prototype=Object.create(Collapsable.prototype),ListaSismosView.prototype.constructor=ListaSismosView,ListaSismosView.prototype.fillBody=function(){var e=this;this.lista.forEach(function(t,i){var a=e.tablaData.tbody.insertRow(i);t.alertapub?a.className="intensidad-moderada-color":t.alertapre&&(a.className="intensidad-fuerte-color"),e.columns.forEach(function(e,i){var n=a.insertCell(i);n.style.textAlign=e.cl,n.style.width=e.width+"px",n.innerHTML=e.html(t)})})},ListaSismosView.prototype.initTable=function(){var e=document.createElement("table");e.className="table table-hover table-sm",e.id="tabla-lista-eventos-id";var t=e.createTHead().insertRow(0),i=document.createElement("tbody");return this.columns.forEach(function(e,i){var a=t.insertCell(i);a.style.textAlign="center",a.style.width=e.width+"px",a.innerHTML=e.head}),e.appendChild(i),{tabla:e,tbody:i}},ListaSismosView.prototype.initPaginator=function(){var e=document.createElement("nav");e.setAttribute("aria-label","paginacion");var t=document.createElement("ul");return t.className="pagination",t.innerHTML='<li class="page-item">  <a class="page-link" href="#" aria-label="Previous">    <span aria-hidden="true">&laquo;</span>    <span class="sr-only">Previous</span>  </a></li><li class="page-item"><a class="page-link" href="#">1</a></li><li class="page-item"><a class="page-link" href="#">2</a></li><li class="page-item"><a class="page-link" href="#">3</a></li><li class="page-item">  <a class="page-link" href="#" aria-label="Next">    <span aria-hidden="true">&raquo;</span>    <span class="sr-only">Next</span>  </a></li> ',e},InfoEvento.prototype.init=function(){this.titulo=document.createElement("h2"),this.titulo.className="text-warning text-center TituloFlash",this.titulo.innerHTML="¡Sismo en progreso!",this.container.appendChild(this.titulo),this.subtitulo=document.createElement("p"),this.subtitulo.className="text-warning text-center h5 mb-1",this.subtitulo.innerHTML="Evento",this.container.appendChild(this.subtitulo),this.info=document.createElement("p"),this.info.className="text-warning text-center h6",this.info.innerHTML="Sensor próximo: ",this.container.appendChild(this.info),this.infoSsn=document.createElement("p"),this.infoSsn.className="text-warning textossn mb-2",this.infoSsn.innerHTML="",this.container.appendChild(this.infoSsn),this.temporizador=document.createElement("div"),this.temporizador.className="card border-danger semibg",this.temporizador.id="temporizador-card";var e=document.createElement("div");e.className="card-body p-1",e.innerHTML="<p class='text-light text-center mb-1 labelinfo'>Distancia aproximada a su localidad: <span id='distancia-id'>0</span> km<br>\n        <span id='infointensidad-id'>Es posible que no perciba sus efectos.</span></p>";var t=document.createElement("div");t.className="card-deck flex-row";var i=document.createElement("div");i.className="card mr-1 mb-1 p-1 border-success special-card";var a=document.createElement("div");a.className="card-body p-0",a.innerHTML="<h6 class='card-title text-warning text-center m-0 labelinfo2'>Tiempo estimado de llegada de la onda S a su posición:</h6>",i.appendChild(a);var n=document.createElement("div");n.className="card border-success ml-0 mb-1 p-1 special-card semaforo",n.style.maxWidth="25%",n.innerHTML="<div class='card-body p-0'><h6 class='text-warning text-center m-0 labelinfo2'>Semáforo</h6>\n                            <h1 class='text-center'><i id='semaforo-id' class='fa fa-circle fa-lg' aria-hidden='true'></i></h1>\n                            </div>",t.appendChild(i),t.appendChild(n),this.tiempo=document.createElement("h1"),this.tiempo.className="text-warning text-center mt-0 pt-0",this.tiempo.id="contador-id",this.tiempo.innerHTML="120 s",a.appendChild(this.tiempo),e.appendChild(t),this.temporizador.appendChild(e),this.container.appendChild(this.temporizador),this.centralesCaption=document.createElement("p"),this.centralesCaption.className="text-warning text-center h6 pt-1",this.centralesCaption.innerHTML="Información de la Centrales de Difusión de Alerta Sísmica"},InfoEvento.prototype.hide=function(){this.container.style.display="none",this.visible=!1,this.MostrarCirculosEpicentro(!1),this.showSensorFeatures(!1),this.showSsnMark(!1),this.mostrarMarcasEventosHistoricos(!0),this.tablac&&(this.tablac.parentNode.removeChild(this.tablac),this.centralesCaption.parentNode.removeChild(this.centralesCaption),this.tablac=null),clearTimeout(this.showTime)},InfoEvento.prototype.show=function(){this.container.style.display="block",this.visible=!0,this.MostrarCirculosEpicentro(!0),this.showSensorFeatures(!0),this.showSsnMark(!0),this.showTime=setTimeout(function(){this.hide()}.bind(this),24e4)},InfoEvento.prototype.showPrueba=function(){this.container.style.display="block",this.visible=!0,this.MostrarCirculosEpicentro(!0),this.showSensorFeatures(!0),this.showSsnMark(!0);var e=this;this.titulo.style.display="block",this.temporizador.style.display="block",this.showTime=setTimeout(function(){this.titulo.style.display="none",this.temporizador.style.display="none",e.hide()},15e4)},InfoEvento.prototype.MostrarEvento=function(e){var t=!1;return this.eventoId===e.id?this.evento=e:(this.visible&&this.hide(),this.eliminarSensorFeatures(),this.evento=e,this.bufferEventos.push(this.evento),this.agregarMarcaEventoHistorico(this.evento),this.eventoId=e.id,this.inicializarParametros(),(t=this.IniciaCirculoS())&&(this.markerSsn.setVisible(!1),this.ocultarSsn())),this.ActualizaInfo(),this.visible?this.MostrarCirculosEpicentro(!0):this.show(),t},InfoEvento.prototype.setPosCliente=function(e){this.posCliente=e,this.distancia=google.maps.geometry.spherical.computeDistanceBetween(this.origen,this.posCliente),$("#distancia-id").html((this.distancia/1e3).toFixed(0))},InfoEvento.prototype.inicializarParametros=function(){var e=this.map.data.getFeatureById(this.evento.numero);this.origen=e.getGeometry().get(),this.distancia=google.maps.geometry.spherical.computeDistanceBetween(this.origen,this.posCliente),$("#distancia-id").html((this.distancia/1e3).toFixed(0))},InfoEvento.prototype.IniciaCirculoS=function(){var e=(new Date).getTime()+this.diff-this.evento.fh,t=4*e,i=8*e,a=(this.distancia-t)/4e3,n=!1;return a<-20?(this.temporizador.style.display="none",this.titulo.style.display="none"):(this.corriendo=!0,this.titulo.style.display="block",this.temporizador.style.display="block",$("#contador-id").html(a.toFixed(1)+" s"),this.markerS.setCenter(this.origen),this.markerS.setRadius(t),this.markerS.setVisible(!0),this.markerP.setCenter(this.origen),this.markerP.setRadius(i),this.markerP.setVisible(!0),n=!0,this.contador=setInterval(function(){var e=(new Date).getTime()+this.diff-this.evento.fh,t=4*e,i=8*e,a=(this.distancia-t)/4e3;this.markerS.setRadius(t),this.markerP.setRadius(i),a>0?$("#contador-id").html(a.toFixed(0)+" s"):$("#contador-id").html("0 s"),e>12e4&&a<-20&&this.StopCirculos()}.bind(this),200)),n},InfoEvento.prototype.StopCirculos=function(){clearInterval(this.contador),this.markerS.setVisible(!1),this.markerP.setVisible(!1),this.corriendo=!1,this.titulo.style.display="none",this.temporizador.style.display="none",this.ocultarSsn(!0)},InfoEvento.prototype.Actualiza=function(e){return e.id===this.evento.id?(this.evento=e,this.ActualizaInfo(),!0):(this.corriendo&&this.Stop(),!1)},InfoEvento.prototype.ActualizaInfo=function(){this.subtitulo.innerHTML=this.evento.fecha+" Sismo en "+this.evento.region,this.info.innerHTML="Sensor próximo:  "+this.evento.numero+" "+this.evento.nombre,this.evento.ssn.info?this.infoSsn.innerHTML=this.evento.ssn.message:this.infoSsn.innerHTML="En espera de información del SSN",$("#semaforo-id").removeClass(function(e,t){var i=t.split(" ").filter(function(e){return 0===e.lastIndexOf("text-",0)}).join(" ");return i}),1==this.evento.color&&this.distancia>15e4?($("#infointensidad-id").html("Es posible que no perciba sus efectos."),$("#semaforo-id").addClass("text-success")):1==this.evento.color?($("#infointensidad-id").html("Es posible que perciba sus efectos."),$("#semaforo-id").addClass("text-warning")):2==this.evento.color&&this.distancia>15e4?($("#infointensidad-id").html("Es posible que perciba sus efectos."),$("#semaforo-id").addClass("text-warning")):(this.evento.color,$("#infointensidad-id").html("Es posible que perciba sus efectos."),$("#semaforo-id").addClass("text-danger")),this.crearTablaEvento(),this.container.appendChild(this.tabla),this.evento.alerta&&(this.crearTablaCentrales(),this.container.appendChild(this.centralesCaption),this.container.appendChild(this.tablac)),this.evento.sensores.forEach(this.addSensorFeature.bind(this)),this.evento.centrales.forEach(this.addCentralFeature.bind(this)),this.evento.ssn.info&&(this.updateSsnMark(this.evento.ssn.feature),this.origen=this.markerSsn.getPosition())},InfoEvento.prototype.calculaSemaforo=function(){this.evento.color},InfoEvento.prototype.updateSsnMark=function(e){e&&(this.markerSsn.setPosition({lat:e.geometry.coordinates[1],lng:e.geometry.coordinates[0]}),this.markerSsn.setLabel(""+e.properties.magnitud),this.markerSsn.setTitle(e.properties.fecha+" sismo magnitud "+e.properties.magnitud+", "+e.properties.localidad+", profundidad "+e.properties.profundidad+"km"))},InfoEvento.prototype.showSsnMark=function(e){e=e||!1,this.evento.ssn.info||(e=!1),this.markerSsn.setVisible(e)},InfoEvento.prototype.toCollection=function(e){return{type:"FeatureCollection",csr:{type:"EPSG",properties:{code:4326}},features:[e]}},InfoEvento.prototype.crearTablaEvento=function(){this.tabla&&this.tabla.parentNode.removeChild(this.tabla),this.tabla=document.createElement("table");var e=this.tabla.createTHead().insertRow(0),t=document.createElement("tbody");this.columnsSensores.forEach(function(t,i){var a=e.insertCell(i);a.style.textAlign="center",a.innerHTML=t.head});var i=this;this.evento.sensores.forEach(function(e,a){if(a<i.maxNumSensores){var n=t.insertRow(a);i.columnsSensores.forEach(function(t,i){var a=n.insertCell(i);a.style.textAlign=t.cl,a.innerHTML=t.html(e)})}}),this.tabla.appendChild(t)},InfoEvento.prototype.crearTablaCentrales=function(){this.tablac&&(this.tablac.parentNode.removeChild(this.tablac),this.centralesCaption.parentNode.removeChild(this.centralesCaption)),this.tablac=document.createElement("table");var e=this.tablac.createTHead().insertRow(0),t=document.createElement("tbody");this.columnsCentrales.forEach(function(t,i){var a=e.insertCell(i);a.style.textAlign="center",a.innerHTML=t.head});var i=this;this.evento.centrales.forEach(function(e,a){var n=t.insertRow(a);i.columnsCentrales.forEach(function(t,i){var a=n.insertCell(i);a.style.textAlign=t.cl,a.innerHTML=t.html(e)})}),this.tablac.appendChild(t)},InfoEvento.prototype.addSensorFeature=function(e){var t="evento-"+e.numero,i=this.map.data.getFeatureById(t);if(i)i.setProperty("color",e.color),this.map.data.overrideStyle(i);else{var a=this.map.data.getFeatureById(e.numero);if(!a)return;this.map.data.add(new google.maps.Data.Feature({geometry:a.getGeometry(),id:"evento-"+e.numero,properties:{numero:e.numero,nombre:e.nombre,color:e.color,tipo:"evento"}}))}},InfoEvento.prototype.addCentralFeature=function(e){var t="alerta-"+e.numero,i=this.map.data.getFeatureById(t);if(i)i.setProperty("color",e.color),i.setProperty("alerta",e.alerta),this.map.data.overrideStyle(i);else{var a=this.map.data.getFeatureById(e.numero);if(!a)return;this.map.data.add(new google.maps.Data.Feature({geometry:a.getGeometry(),id:"alerta-"+e.numero,properties:{numero:e.numero,nombre:e.nombre,color:e.color,tipo:"alerta",alerta:e.alerta}}))}},InfoEvento.prototype.showSensorFeatures=function(e){e=e||!1;var t=this;this.evento.sensores.forEach(function(i){var a="evento-"+i.numero,n=t.map.data.getFeatureById(a);n.setProperty("visible",e),t.map.data.overrideStyle(n)}.bind(t)),this.evento.centrales.forEach(function(i){var a="alerta-"+i.numero,n=t.map.data.getFeatureById(a);n.setProperty("visible",e),t.map.data.overrideStyle(n)}.bind(t))},InfoEvento.prototype.eliminarSensorFeatures=function(){var e=this;this.evento&&(this.evento.sensores.forEach(function(t){var i="evento-"+t.numero,a=e.map.data.getFeatureById(i);a&&e.map.data.remove(a)}.bind(e)),this.evento.centrales.forEach(function(t){var i="alerta-"+t.numero,a=e.map.data.getFeatureById(i);a&&e.map.data.remove(a)}.bind(e)))},InfoEvento.prototype.MostrarCirculosEpicentro=function(e){var t=(e=e||!1)?this.map:null,i=this.origen;this.CirculosEpicentro.forEach(function(e){e.setCenter(i),e.setMap(t)})},InfoEvento.prototype.ocultarSsn=function(e){e=e||!1;var t=this;this.map.data.forEach(function(i){"ssn"===i.getProperty("tipo")&&(e?i.setProperty("visible",e):i.setProperty("visible",!i.getProperty("visible")),t.map.data.overrideStyle(i))})},InfoEvento.prototype.agregarMarcaEventoHistorico=function(e){var t=this.map.data.getFeatureById(e.numero);if(t){var i=t.getGeometry();e.ssn.info&&(i={lat:e.ssn.feature.geometry.coordinates[1],lng:e.ssn.feature.geometry.coordinates[0]});var a="epicentroh-"+e.numero;this.map.data.getFeatureById(a)||this.map.data.add(new google.maps.Data.Feature({geometry:i,id:a,properties:{numero:e.numero,nombre:e.nombre,color:e.color,fecha:e.fecha,fh:e.fh,region:e.region,visible:!1,tipo:"epicentro"}}))}},InfoEvento.prototype.mostrarMarcasEventosHistoricos=function(e){e=e||!1;var t=this;this.bufferEventos.forEach(function(i){var a="epicentroh-"+i.numero,n=t.map.data.getFeatureById(a);n&&(n.setProperty("visible",e),t.map.data.overrideStyle(n))})};